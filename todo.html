<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>
  $(document).ready(populate);

  function populate() {
      update_list();
  }

  function update_list() {
    $.getJSON("api/tasks?mode=select&user=nathan", function(data){
      $.each( data, function( key, val ) {
        addTaskToTable(val);
      });
    });
  }

  function finishTask (user, dateTime) {
    var requestUri = 'api/tasks?mode=delete&user=nathan&insertTime=' + dateTime;
    $.get(encodeURI(requestUri));

  }

  function addTaskToTable (val) {
    var table = document.getElementById('table1');
    var table_row = document.createElement('tr');

    var table_div1 = document.createElement('td');
    table_div1.appendChild(document.createTextNode(val['task']));
    table_row.appendChild(table_div1);

    var table_div2 = document.createElement('td');
    var finishButton = document.createElement('button');
    finishButton.onclick = function (){
      finishTask("nathan", val['insertTime']);
      this.parentNode.parentNode.remove();
    };
    finishButton.appendChild(document.createTextNode('Finish'));
    table_div2.appendChild(finishButton);
    table_row.appendChild(table_div2);

    table.appendChild(table_row);
  }

  function addTask (form) {
    var newTask = form.taskDescription.value;

    var dateTime = new Date().toISOString().slice(0,19).replace('T', ' ');

    var val = {
      user: "nathan",
      insertTime: dateTime,
      task: newTask
    };
    addTaskToTable(val);

    var requestUri = 'api/tasks?mode=insert&user=nathan&insertTime=' + dateTime +
        '&task=' + newTask;
    $.get(encodeURI(requestUri));

  }

  </script>
</head>
<body>
  <h1> Get Ready to WORK! </h1>
  <p> Here are the things you need to do: </p>
  <table id="table1">
    <tr>
        <td>Test1</td> <td>Placeholder</td>
    </tr>
  </table>
  <br />
  <form name="createTaskForm">
    <input type="text" name="taskDescription" value="">
    <input type="button" name="submitTaskButton" value="Add" onClick="addTask(this.form)">
  </form>
</body>
</html>
